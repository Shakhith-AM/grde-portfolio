<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Portfolio: GRDE Engine</title>
<meta name="description" content="GRDE Portfolio Engine ‚Äî An age-based asset allocation framework for Gold, Real Estate, Debt & Equity. An Architect's Blueprint for Wealth.">
<meta name="theme-color" content="#0D0F14">
<meta name="apple-mobile-web-app-capable" content="yes">
<meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
<meta name="apple-mobile-web-app-title" content="GRDE Engine">
<link rel="manifest" href="manifest.json">
<link rel="apple-touch-icon" href="icons/icon-192.png">
<link rel="preconnect" href="https://fonts.googleapis.com">
<link href="https://fonts.googleapis.com/css2?family=DM+Sans:ital,opsz,wght@0,9..40,300;0,9..40,400;0,9..40,500;0,9..40,600;0,9..40,700&family=Playfair+Display:wght@400;500;600;700&display=swap" rel="stylesheet">
<style>
  :root {
    --gold: #D4A017;
    --gold-light: #F5E6B8;
    --gold-bg: rgba(212,160,23,0.08);
    --red: #C0392B;
    --red-light: #F5C6C0;
    --red-bg: rgba(192,57,43,0.08);
    --blue: #2874A6;
    --blue-light: #AED6F1;
    --blue-bg: rgba(40,116,166,0.08);
    --green: #1E8449;
    --green-light: #A9DFBF;
    --green-bg: rgba(30,132,73,0.08);
    
    --bg-primary: #0D0F14;
    --bg-secondary: #141720;
    --bg-card: #1A1E2A;
    --bg-card-hover: #1F2436;
    --border: rgba(255,255,255,0.06);
    --border-hover: rgba(255,255,255,0.12);
    --text-primary: #F0F0F0;
    --text-secondary: #8A8F9E;
    --text-muted: #5A5F6E;
    --shadow: 0 4px 24px rgba(0,0,0,0.3);
    --radius: 16px;
    --radius-sm: 10px;
  }

  * { margin:0; padding:0; box-sizing:border-box; }
  
  body {
    font-family: 'DM Sans', sans-serif;
    background: var(--bg-primary);
    color: var(--text-primary);
    line-height: 1.6;
    min-height: 100vh;
    -webkit-font-smoothing: antialiased;
  }

  /* Scrollbar */
  ::-webkit-scrollbar { width: 6px; }
  ::-webkit-scrollbar-track { background: transparent; }
  ::-webkit-scrollbar-thumb { background: rgba(255,255,255,0.1); border-radius: 3px; }

  /* ===== HEADER ===== */
  .header {
    position: sticky; top: 0; z-index: 100;
    background: rgba(13,15,20,0.85);
    backdrop-filter: blur(20px);
    border-bottom: 1px solid var(--border);
    padding: 16px 0;
  }
  .header-inner {
    max-width: 1200px; margin: 0 auto; padding: 0 24px;
    display: flex; align-items: center; justify-content: space-between;
  }
  .logo-group { display: flex; align-items: center; gap: 14px; }
  .logo-dots {
    display: grid; grid-template-columns: 1fr 1fr; gap: 4px;
    width: 36px; height: 36px;
  }
  .logo-dot {
    width: 16px; height: 16px; border-radius: 50%;
    box-shadow: 0 0 8px rgba(0,0,0,0.3);
  }
  .logo-dot.g { background: var(--gold); }
  .logo-dot.r { background: var(--red); }
  .logo-dot.d { background: var(--blue); }
  .logo-dot.e { background: var(--green); }
  .logo-text { display: flex; flex-direction: column; }
  .logo-title {
    font-family: 'Playfair Display', serif;
    font-size: 18px; font-weight: 600; letter-spacing: 0.5px;
    color: var(--text-primary);
  }
  .logo-subtitle {
    font-size: 10px; font-weight: 500; letter-spacing: 2px;
    text-transform: uppercase; color: var(--text-muted);
  }
  .header-badge {
    font-size: 11px; padding: 6px 14px;
    background: rgba(212,160,23,0.1); border: 1px solid rgba(212,160,23,0.2);
    border-radius: 20px; color: var(--gold);
    letter-spacing: 0.5px; font-weight: 500;
  }
  .region-select {
    padding: 7px 12px; border-radius: 8px;
    background: var(--bg-secondary); border: 1px solid var(--border);
    color: var(--text-primary); font-family: 'DM Sans', sans-serif;
    font-size: 13px; cursor: pointer; outline: none;
    transition: border-color 0.2s;
    -webkit-appearance: none; appearance: none;
    background-image: url("data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' width='12' height='12' fill='%238A8F9E' viewBox='0 0 16 16'%3E%3Cpath d='M8 11L3 6h10z'/%3E%3C/svg%3E");
    background-repeat: no-repeat; background-position: right 10px center;
    padding-right: 30px;
  }
  .region-select:hover, .region-select:focus {
    border-color: rgba(212,160,23,0.4);
  }
  .header-right { display: flex; align-items: center; gap: 12px; }

  /* ===== LAYOUT ===== */
  .container { max-width: 1200px; margin: 0 auto; padding: 32px 24px 80px; }
  
  .section-label {
    font-size: 11px; font-weight: 600; letter-spacing: 2.5px;
    text-transform: uppercase; color: var(--text-muted);
    margin-bottom: 8px;
  }
  .section-title {
    font-family: 'Playfair Display', serif;
    font-size: 28px; font-weight: 600; color: var(--text-primary);
    margin-bottom: 6px;
  }
  .section-desc {
    font-size: 14px; color: var(--text-secondary); max-width: 600px;
    margin-bottom: 32px; line-height: 1.7;
  }

  .card {
    background: var(--bg-card);
    border: 1px solid var(--border);
    border-radius: var(--radius);
    padding: 28px;
    transition: border-color 0.3s, box-shadow 0.3s;
  }
  .card:hover {
    border-color: var(--border-hover);
    box-shadow: var(--shadow);
  }
  .card-title {
    font-size: 13px; font-weight: 600; letter-spacing: 1.5px;
    text-transform: uppercase; color: var(--text-secondary);
    margin-bottom: 20px;
  }

  /* ===== AGE SLIDER ===== */
  .age-section { margin-bottom: 48px; }
  .age-card {
    background: var(--bg-card);
    border: 1px solid var(--border);
    border-radius: var(--radius);
    padding: 36px;
  }
  .age-display {
    display: flex; align-items: baseline; gap: 8px;
    margin-bottom: 28px;
  }
  .age-number {
    font-family: 'Playfair Display', serif;
    font-size: 64px; font-weight: 700; color: var(--text-primary);
    line-height: 1;
  }
  .age-label { font-size: 16px; color: var(--text-secondary); }

  .slider-container { position: relative; margin-bottom: 24px; }
  input[type="range"] {
    -webkit-appearance: none; width: 100%; height: 6px;
    background: linear-gradient(90deg, var(--green) 0%, var(--gold) 50%, var(--red) 100%);
    border-radius: 3px; outline: none; cursor: pointer;
  }
  input[type="range"]::-webkit-slider-thumb {
    -webkit-appearance: none; width: 24px; height: 24px;
    background: #fff; border-radius: 50%; cursor: grab;
    box-shadow: 0 2px 8px rgba(0,0,0,0.3), 0 0 0 3px rgba(255,255,255,0.1);
    transition: transform 0.15s;
  }
  input[type="range"]::-webkit-slider-thumb:active {
    cursor: grabbing; transform: scale(1.15);
  }
  input[type="range"]::-moz-range-thumb {
    width: 24px; height: 24px;
    background: #fff; border-radius: 50%; cursor: grab; border: none;
    box-shadow: 0 2px 8px rgba(0,0,0,0.3);
  }
  .slider-labels {
    display: flex; justify-content: space-between;
    font-size: 12px; color: var(--text-muted); margin-top: 8px;
  }

  /* ===== ALLOCATION BARS ===== */
  .allocation-grid {
    display: grid; grid-template-columns: repeat(4, 1fr); gap: 16px;
    margin-top: 32px;
  }
  .alloc-item {
    background: var(--bg-secondary);
    border: 1px solid var(--border);
    border-radius: var(--radius-sm);
    padding: 20px; text-align: center;
    transition: all 0.3s;
  }
  .alloc-item:hover { border-color: var(--border-hover); }
  .alloc-letter {
    font-family: 'Playfair Display', serif;
    font-size: 24px; font-weight: 700; margin-bottom: 4px;
  }
  .alloc-name {
    font-size: 11px; font-weight: 500; letter-spacing: 1px;
    text-transform: uppercase; color: var(--text-muted); margin-bottom: 14px;
  }
  .alloc-pct {
    font-size: 32px; font-weight: 700; margin-bottom: 10px;
    transition: all 0.3s;
  }
  .alloc-bar-track {
    width: 100%; height: 6px; background: rgba(255,255,255,0.06);
    border-radius: 3px; overflow: hidden;
  }
  .alloc-bar-fill {
    height: 100%; border-radius: 3px;
    transition: width 0.5s cubic-bezier(0.4, 0, 0.2, 1);
  }
  .alloc-item.gold .alloc-letter, .alloc-item.gold .alloc-pct { color: var(--gold); }
  .alloc-item.gold .alloc-bar-fill { background: var(--gold); }
  .alloc-item.real .alloc-letter, .alloc-item.real .alloc-pct { color: var(--red); }
  .alloc-item.real .alloc-bar-fill { background: var(--red); }
  .alloc-item.debt .alloc-letter, .alloc-item.debt .alloc-pct { color: var(--blue); }
  .alloc-item.debt .alloc-bar-fill { background: var(--blue); }
  .alloc-item.eqty .alloc-letter, .alloc-item.eqty .alloc-pct { color: var(--green); }
  .alloc-item.eqty .alloc-bar-fill { background: var(--green); }

  /* ===== CHARTS GRID ===== */
  .charts-section { margin-bottom: 48px; }
  .charts-grid {
    display: grid; grid-template-columns: 1fr 1fr; gap: 20px;
  }

  /* ===== PIE / DONUT CHART ===== */
  .chart-container { position: relative; display: flex; justify-content: center; align-items: center; }
  .donut-chart { position: relative; width: 220px; height: 220px; }
  .donut-chart svg { width: 100%; height: 100%; transform: rotate(-90deg); }
  .donut-chart circle {
    fill: none; stroke-width: 28;
    transition: stroke-dasharray 0.6s cubic-bezier(0.4, 0, 0.2, 1),
                stroke-dashoffset 0.6s cubic-bezier(0.4, 0, 0.2, 1);
  }
  .donut-center {
    position: absolute; top: 50%; left: 50%; transform: translate(-50%, -50%);
    text-align: center;
  }
  .donut-center-value {
    font-family: 'Playfair Display', serif;
    font-size: 28px; font-weight: 700;
  }
  .donut-center-label {
    font-size: 11px; color: var(--text-muted); text-transform: uppercase;
    letter-spacing: 1px;
  }
  .chart-legend {
    display: flex; flex-direction: column; gap: 12px;
    margin-top: 20px;
  }
  .legend-item {
    display: flex; align-items: center; gap: 10px; font-size: 13px;
  }
  .legend-dot {
    width: 10px; height: 10px; border-radius: 50%; flex-shrink: 0;
  }
  .legend-label { color: var(--text-secondary); }
  .legend-value { margin-left: auto; font-weight: 600; color: var(--text-primary); }

  /* ===== BAR CHART ===== */
  .bar-chart { display: flex; flex-direction: column; gap: 16px; }
  .bar-row { display: flex; align-items: center; gap: 12px; }
  .bar-label {
    width: 80px; font-size: 12px; font-weight: 500;
    color: var(--text-secondary); text-align: right; flex-shrink: 0;
  }
  .bar-track {
    flex: 1; height: 24px; background: rgba(255,255,255,0.04);
    border-radius: 6px; overflow: hidden; position: relative;
  }
  .bar-fill {
    height: 100%; border-radius: 6px;
    transition: width 0.5s cubic-bezier(0.4, 0, 0.2, 1);
    display: flex; align-items: center; padding-left: 10px;
    font-size: 12px; font-weight: 600; color: #fff;
    min-width: fit-content;
  }

  /* ===== ISR SECTION ===== */
  .isr-section { margin-bottom: 48px; }
  .isr-grid {
    display: grid; grid-template-columns: 1fr 1fr; gap: 20px;
  }
  .isr-gauge-container {
    display: flex; flex-direction: column; align-items: center; gap: 24px;
  }
  .isr-gauge { position: relative; width: 200px; height: 200px; }
  .isr-gauge svg { width: 100%; height: 100%; }
  .isr-gauge-center {
    position: absolute; top: 50%; left: 50%; transform: translate(-50%, -50%);
    text-align: center;
  }
  .isr-score {
    font-family: 'Playfair Display', serif;
    font-size: 36px; font-weight: 700;
  }
  .isr-label-text {
    font-size: 10px; text-transform: uppercase; letter-spacing: 1.5px;
    color: var(--text-muted);
  }
  .isr-status-badge {
    display: inline-flex; align-items: center; gap: 6px;
    padding: 8px 18px; border-radius: 20px;
    font-size: 13px; font-weight: 600;
    transition: all 0.3s;
  }
  .isr-status-badge.aggressive {
    background: rgba(192,57,43,0.12); color: #E74C3C;
    border: 1px solid rgba(231,76,60,0.2);
  }
  .isr-status-badge.moderate {
    background: rgba(212,160,23,0.12); color: var(--gold);
    border: 1px solid rgba(212,160,23,0.2);
  }
  .isr-status-badge.balanced {
    background: rgba(30,132,73,0.12); color: #2ECC71;
    border: 1px solid rgba(46,204,113,0.2);
  }
  .isr-status-badge.conservative {
    background: rgba(40,116,166,0.12); color: #3498DB;
    border: 1px solid rgba(52,152,219,0.2);
  }
  .isr-status-dot {
    width: 8px; height: 8px; border-radius: 50%;
    animation: pulse 2s infinite;
  }
  @keyframes pulse {
    0%, 100% { opacity: 1; }
    50% { opacity: 0.4; }
  }
  .isr-status-badge.aggressive .isr-status-dot { background: #E74C3C; }
  .isr-status-badge.moderate .isr-status-dot { background: var(--gold); }
  .isr-status-badge.balanced .isr-status-dot { background: #2ECC71; }
  .isr-status-badge.conservative .isr-status-dot { background: #3498DB; }

  .isr-details { display: flex; flex-direction: column; gap: 16px; }
  .isr-split-bar {
    height: 14px; border-radius: 7px; overflow: hidden;
    display: flex; margin-bottom: 8px;
  }
  .isr-split-stable {
    background: linear-gradient(90deg, var(--gold), var(--blue));
    transition: width 0.5s;
    display: flex; align-items: center; justify-content: center;
    font-size: 10px; font-weight: 700; color: #fff;
  }
  .isr-split-growth {
    background: var(--green);
    transition: width 0.5s;
    display: flex; align-items: center; justify-content: center;
    font-size: 10px; font-weight: 700; color: #fff;
  }
  .isr-split-labels {
    display: flex; justify-content: space-between; font-size: 12px;
    color: var(--text-secondary); margin-bottom: 20px;
  }

  .isr-comparison {
    background: var(--bg-secondary); border-radius: var(--radius-sm);
    padding: 16px; border: 1px solid var(--border);
  }
  .isr-comp-row {
    display: flex; justify-content: space-between; align-items: center;
    padding: 8px 0;
  }
  .isr-comp-row + .isr-comp-row { border-top: 1px solid var(--border); }
  .isr-comp-label { font-size: 13px; color: var(--text-secondary); }
  .isr-comp-value { font-size: 14px; font-weight: 600; }

  .isr-action {
    padding: 16px; border-radius: var(--radius-sm);
    font-size: 13px; line-height: 1.7;
    border: 1px solid;
  }
  .isr-action.aggressive {
    background: rgba(192,57,43,0.06); border-color: rgba(192,57,43,0.15);
    color: #F1948A;
  }
  .isr-action.moderate {
    background: rgba(212,160,23,0.06); border-color: rgba(212,160,23,0.15);
    color: #F7DC6F;
  }
  .isr-action.balanced {
    background: rgba(30,132,73,0.06); border-color: rgba(30,132,73,0.15);
    color: #A9DFBF;
  }
  .isr-action.conservative {
    background: rgba(40,116,166,0.06); border-color: rgba(40,116,166,0.15);
    color: #AED6F1;
  }

  /* ===== PORTFOLIO TRACKER ===== */
  .tracker-section { margin-bottom: 48px; }
  .tracker-grid {
    display: grid; grid-template-columns: 1fr 1fr; gap: 20px;
  }
  .input-group { margin-bottom: 14px; }
  .input-label {
    display: flex; align-items: center; gap: 8px;
    font-size: 12px; font-weight: 500; color: var(--text-secondary);
    margin-bottom: 6px;
  }
  .input-dot {
    width: 8px; height: 8px; border-radius: 50%;
  }
  .input-field {
    width: 100%; padding: 10px 14px;
    background: var(--bg-secondary); border: 1px solid var(--border);
    border-radius: 8px; color: var(--text-primary);
    font-family: 'DM Sans', sans-serif; font-size: 14px;
    transition: border-color 0.2s, box-shadow 0.2s;
    outline: none;
  }
  .input-field:focus {
    border-color: rgba(212,160,23,0.4);
    box-shadow: 0 0 0 3px rgba(212,160,23,0.08);
  }
  .input-field::placeholder { color: var(--text-muted); }

  .group-header {
    display: flex; align-items: center; gap: 8px;
    margin-bottom: 16px; padding-bottom: 10px;
    border-bottom: 1px solid var(--border);
  }
  .group-dot { width: 12px; height: 12px; border-radius: 50%; }
  .group-label {
    font-size: 14px; font-weight: 600;
  }
  .group-total {
    margin-left: auto; font-size: 14px; font-weight: 600;
    color: var(--text-secondary);
  }

  /* Variance Table */
  .variance-table { width: 100%; border-collapse: separate; border-spacing: 0 4px; }
  .variance-table th {
    font-size: 11px; font-weight: 600; letter-spacing: 1px;
    text-transform: uppercase; color: var(--text-muted);
    padding: 8px 12px; text-align: left;
  }
  .variance-table td {
    padding: 10px 12px; font-size: 13px;
    background: var(--bg-secondary); color: var(--text-secondary);
  }
  .variance-table tr td:first-child { border-radius: 8px 0 0 8px; }
  .variance-table tr td:last-child { border-radius: 0 8px 8px 0; }
  .variance-positive { color: #2ECC71; }
  .variance-negative { color: #E74C3C; }
  .variance-neutral { color: var(--text-muted); }

  /* ===== FOOTER ===== */
  .footer {
    border-top: 1px solid var(--border);
    padding: 32px 0;
    text-align: center;
  }
  .footer-inner {
    max-width: 1200px; margin: 0 auto; padding: 0 24px;
  }
  .footer-brand {
    display: flex; align-items: center; justify-content: center; gap: 10px;
    margin-bottom: 16px;
  }
  .footer-dots {
    display: grid; grid-template-columns: 1fr 1fr; gap: 3px;
    width: 20px; height: 20px;
  }
  .footer-dot { width: 8px; height: 8px; border-radius: 50%; }
  .footer-text {
    font-size: 12px; color: var(--text-muted); line-height: 1.8;
  }
  .footer-text a { color: var(--gold); text-decoration: none; }
  .footer-disclaimer {
    font-size: 11px; color: var(--text-muted); margin-top: 16px;
    max-width: 700px; margin-left: auto; margin-right: auto;
    padding: 12px 16px; background: rgba(255,255,255,0.02);
    border-radius: 8px; border: 1px solid var(--border);
    line-height: 1.7;
  }

  /* ===== TABS ===== */
  .tabs {
    display: flex; gap: 4px; margin-bottom: 32px;
    background: var(--bg-secondary); padding: 4px;
    border-radius: var(--radius-sm); width: fit-content;
  }
  .tab {
    padding: 10px 20px; border-radius: 8px;
    font-size: 13px; font-weight: 500; color: var(--text-muted);
    cursor: pointer; transition: all 0.2s; border: none;
    background: transparent; font-family: inherit;
  }
  .tab:hover { color: var(--text-secondary); }
  .tab.active {
    background: var(--bg-card); color: var(--text-primary);
    box-shadow: 0 2px 8px rgba(0,0,0,0.2);
  }
  .tab-content { display: none; }
  .tab-content.active { display: block; animation: fadeIn 0.3s; }
  @keyframes fadeIn { from { opacity: 0; transform: translateY(8px); } to { opacity: 1; transform: translateY(0); } }

  /* ===== RESPONSIVE ===== */
  @media (max-width: 768px) {
    .allocation-grid { grid-template-columns: repeat(2, 1fr); }
    .charts-grid, .isr-grid, .tracker-grid { grid-template-columns: 1fr; }
    .age-number { font-size: 48px; }
    .section-title { font-size: 22px; }
    .card { padding: 20px; }
    .age-card { padding: 24px; }
    .header-badge { display: none; }
    .tabs { width: 100%; }
    .tab { flex: 1; text-align: center; padding: 10px 12px; font-size: 12px; }
  }
  @media (max-width: 480px) {
    .allocation-grid { grid-template-columns: 1fr 1fr; gap: 10px; }
    .alloc-pct { font-size: 24px; }
    .container { padding: 20px 16px 60px; }
  }
</style>
</head>
<body>

<!-- HEADER -->
<header class="header">
  <div class="header-inner">
    <div class="logo-group">
      <div class="logo-dots">
        <div class="logo-dot g"></div>
        <div class="logo-dot r"></div>
        <div class="logo-dot d"></div>
        <div class="logo-dot e"></div>
      </div>
      <div class="logo-text">
        <span class="logo-title">Portfolio: GRDE Engine</span>
        <span class="logo-subtitle">An Architect's Blueprint for Wealth</span>
      </div>
    </div>
    <div class="header-right">
      <select class="region-select" id="regionSelect">
        <option value="IN">üáÆüá≥ India (‚Çπ)</option>
        <option value="US">üá∫üá∏ USA ($)</option>
        <option value="GB">üá¨üáß UK (¬£)</option>
        <option value="EU">üá™üá∫ Europe (‚Ç¨)</option>
        <option value="AE">üá¶üá™ UAE (AED)</option>
        <option value="SG">üá∏üá¨ Singapore (S$)</option>
        <option value="AU">üá¶üá∫ Australia (A$)</option>
        <option value="JP">üáØüáµ Japan (¬•)</option>
        <option value="CA">üá®üá¶ Canada (C$)</option>
        <option value="MY">üá≤üáæ Malaysia (RM)</option>
      </select>
      <span class="header-badge">v2.1</span>
    </div>
  </div>
</header>

<main class="container">

  <!-- TABS -->
  <div class="tabs">
    <button class="tab active" data-tab="allocator">Allocator</button>
    <button class="tab" data-tab="tracker">Portfolio Tracker</button>
    <button class="tab" data-tab="isr">ISR Analysis</button>
  </div>

  <!-- ==================== TAB 1: ALLOCATOR ==================== -->
  <div class="tab-content active" id="tab-allocator">
    <div class="section-label">Age-Based Risk Engine</div>
    <div class="section-title">Target Allocation</div>
    <div class="section-desc">
      Adjust your age to see how the GRDE framework adapts. Younger investors tilt toward equity for growth; older investors shift toward stability assets for peace of mind.
    </div>

    <div class="age-card">
      <div class="age-display">
        <span class="age-number" id="ageDisplay">50</span>
        <span class="age-label">years old</span>
      </div>
      <div class="slider-container">
        <input type="range" id="ageSlider" min="25" max="80" value="50" step="1">
        <div class="slider-labels">
          <span>25 ‚Äî Higher Growth</span>
          <span>80 ‚Äî Higher Stability</span>
        </div>
      </div>

      <div class="allocation-grid">
        <div class="alloc-item gold">
          <div class="alloc-letter">G</div>
          <div class="alloc-name">Gold & Silver</div>
          <div class="alloc-pct" id="allocG">10%</div>
          <div class="alloc-bar-track"><div class="alloc-bar-fill" id="barG" style="width:10%"></div></div>
        </div>
        <div class="alloc-item real">
          <div class="alloc-letter">R</div>
          <div class="alloc-name">Real Estate</div>
          <div class="alloc-pct" id="allocR">15%</div>
          <div class="alloc-bar-track"><div class="alloc-bar-fill" id="barR" style="width:15%"></div></div>
        </div>
        <div class="alloc-item debt">
          <div class="alloc-letter">D</div>
          <div class="alloc-name">Debt</div>
          <div class="alloc-pct" id="allocD">25%</div>
          <div class="alloc-bar-track"><div class="alloc-bar-fill" id="barD" style="width:25%"></div></div>
        </div>
        <div class="alloc-item eqty">
          <div class="alloc-letter">E</div>
          <div class="alloc-name">Equity</div>
          <div class="alloc-pct" id="allocE">50%</div>
          <div class="alloc-bar-track"><div class="alloc-bar-fill" id="barE" style="width:50%"></div></div>
        </div>
      </div>
    </div>

    <!-- CHARTS -->
    <div class="charts-grid" style="margin-top:32px;">
      <div class="card">
        <div class="card-title">Allocation Breakdown</div>
        <div class="chart-container" style="flex-direction:column;">
          <div class="donut-chart">
            <svg viewBox="0 0 200 200">
              <circle id="donutE" cx="100" cy="100" r="75" stroke="var(--green)" />
              <circle id="donutD" cx="100" cy="100" r="75" stroke="var(--blue)" />
              <circle id="donutR" cx="100" cy="100" r="75" stroke="var(--red)" />
              <circle id="donutG" cx="100" cy="100" r="75" stroke="var(--gold)" />
            </svg>
            <div class="donut-center">
              <div class="donut-center-value" id="donutTotal">‚Çπ10L</div>
              <div class="donut-center-label">Target</div>
            </div>
          </div>
          <div class="chart-legend" id="pieLegend"></div>
        </div>
      </div>
      <div class="card">
        <div class="card-title">Component Comparison</div>
        <div class="bar-chart" id="barChart"></div>
      </div>
    </div>
  </div>

  <!-- ==================== TAB 2: PORTFOLIO TRACKER ==================== -->
  <div class="tab-content" id="tab-tracker">
    <div class="section-label">Live Portfolio</div>
    <div class="section-title">Track Your Holdings</div>
    <div class="section-desc">
      Enter your current holdings to see how your actual allocation compares to the GRDE target for your age.
    </div>

    <div class="tracker-grid">
      <div class="card">
        <div class="group-header">
          <div class="group-dot" style="background:var(--gold)"></div>
          <div class="group-label" style="color:var(--gold)">G ‚Äî Gold & Silver</div>
          <div class="group-total" id="totalG">‚Çπ0</div>
        </div>
        <div class="input-group">
          <div class="input-label"><div class="input-dot" style="background:var(--gold)"></div> Gold ETFs</div>
          <input type="text" class="input-field portfolio-input" data-group="G" id="inp-goldEtf" placeholder="‚Çπ 0" value="90000">
        </div>
        <div class="input-group">
          <div class="input-label"><div class="input-dot" style="background:var(--gold)"></div> Silver ETFs</div>
          <input type="text" class="input-field portfolio-input" data-group="G" id="inp-silverEtf" placeholder="‚Çπ 0" value="10000">
        </div>

        <div class="group-header" style="margin-top:24px;">
          <div class="group-dot" style="background:var(--red)"></div>
          <div class="group-label" style="color:var(--red)">R ‚Äî Real Estate</div>
          <div class="group-total" id="totalR">‚Çπ0</div>
        </div>
        <div class="input-group">
          <div class="input-label"><div class="input-dot" style="background:var(--red)"></div> REITs</div>
          <input type="text" class="input-field portfolio-input" data-group="R" id="inp-reits" placeholder="‚Çπ 0" value="90000">
        </div>
        <div class="input-group">
          <div class="input-label"><div class="input-dot" style="background:var(--red)"></div> InvITs</div>
          <input type="text" class="input-field portfolio-input" data-group="R" id="inp-invits" placeholder="‚Çπ 0" value="60000">
        </div>
      </div>

      <div class="card">
        <div class="group-header">
          <div class="group-dot" style="background:var(--blue)"></div>
          <div class="group-label" style="color:var(--blue)">D ‚Äî Debt</div>
          <div class="group-total" id="totalD">‚Çπ0</div>
        </div>
        <div class="input-group">
          <div class="input-label"><div class="input-dot" style="background:var(--blue)"></div> Liquid Funds</div>
          <input type="text" class="input-field portfolio-input" data-group="D" id="inp-liquid" placeholder="‚Çπ 0" value="100000">
        </div>
        <div class="input-group">
          <div class="input-label"><div class="input-dot" style="background:var(--blue)"></div> FD + POMIS</div>
          <input type="text" class="input-field portfolio-input" data-group="D" id="inp-fd" placeholder="‚Çπ 0" value="150000">
        </div>
        <div class="input-group">
          <div class="input-label"><div class="input-dot" style="background:var(--blue)"></div> Bonds / NCDs</div>
          <input type="text" class="input-field portfolio-input" data-group="D" id="inp-bonds" placeholder="‚Çπ 0" value="0">
        </div>

        <div class="group-header" style="margin-top:24px;">
          <div class="group-dot" style="background:var(--green)"></div>
          <div class="group-label" style="color:var(--green)">E ‚Äî Equity</div>
          <div class="group-total" id="totalE">‚Çπ0</div>
        </div>
        <div class="input-group">
          <div class="input-label"><div class="input-dot" style="background:var(--green)"></div> Mutual Funds</div>
          <input type="text" class="input-field portfolio-input" data-group="E" id="inp-mf" placeholder="‚Çπ 0" value="250000">
        </div>
        <div class="input-group">
          <div class="input-label"><div class="input-dot" style="background:var(--green)"></div> Indian ETFs</div>
          <input type="text" class="input-field portfolio-input" data-group="E" id="inp-inEtf" placeholder="‚Çπ 0" value="200000">
        </div>
        <div class="input-group">
          <div class="input-label"><div class="input-dot" style="background:var(--green)"></div> US / Intl ETFs</div>
          <input type="text" class="input-field portfolio-input" data-group="E" id="inp-usEtf" placeholder="‚Çπ 0" value="50000">
        </div>
      </div>
    </div>

    <!-- Variance Analysis -->
    <div class="card" style="margin-top:20px;">
      <div class="card-title">Variance Analysis ‚Äî Actual vs Target</div>
      <div style="display:flex;align-items:center;gap:16px;margin-bottom:20px;flex-wrap:wrap;">
        <div style="font-size:14px;color:var(--text-secondary);">Total Portfolio:</div>
        <div id="portfolioTotal" style="font-family:'Playfair Display',serif;font-size:28px;font-weight:700;color:var(--text-primary);">‚Çπ10,00,000</div>
      </div>
      <table class="variance-table">
        <thead>
          <tr>
            <th>Asset</th>
            <th id="thActualAmt">Actual ‚Çπ</th>
            <th>Actual %</th>
            <th>Target %</th>
            <th>Variance</th>
          </tr>
        </thead>
        <tbody id="varianceBody"></tbody>
      </table>
    </div>
  </div>

  <!-- ==================== TAB 3: ISR ANALYSIS ==================== -->
  <div class="tab-content" id="tab-isr">
    <div class="section-label">INVESTMENT SAFETY RATIO</div>
    <div class="section-title">ISR Analysis</div>
    <div class="section-desc">
      Your ISR measures the proportion of stable, income-generating assets (G + R + D) against volatile growth assets (E). An ISR above 50% signals peace of mind.
    </div>

    <div class="isr-grid">
      <div class="card">
        <div class="card-title">Actual ISR ‚Äî From Your Portfolio</div>
        <div class="isr-gauge-container">
          <div class="isr-gauge">
            <svg viewBox="0 0 200 200">
              <circle cx="100" cy="100" r="80" fill="none" stroke="rgba(255,255,255,0.04)" stroke-width="18" />
              <circle id="isrArc" cx="100" cy="100" r="80" fill="none" stroke="var(--green)" stroke-width="18"
                stroke-dasharray="0 502.65" stroke-linecap="round"
                style="transform:rotate(-90deg);transform-origin:center;transition:all 0.6s cubic-bezier(0.4,0,0.2,1);" />
            </svg>
            <div class="isr-gauge-center">
              <div class="isr-score" id="isrActualScore">50%</div>
              <div class="isr-label-text">Actual ISR</div>
            </div>
          </div>
          <div id="isrBadge" class="isr-status-badge balanced">
            <div class="isr-status-dot"></div>
            <span id="isrBadgeText">Balanced Portfolio</span>
          </div>
        </div>
      </div>

      <div class="card">
        <div class="card-title">Stability vs Growth Split</div>
        <div class="isr-details">
          <div class="isr-split-bar">
            <div class="isr-split-stable" id="isrBarStable" style="width:50%"><span id="isrBarStableText">50%</span></div>
            <div class="isr-split-growth" id="isrBarGrowth" style="width:50%"><span id="isrBarGrowthText">50%</span></div>
          </div>
          <div class="isr-split-labels">
            <span>‚¨õ Stable (G+R+D)</span>
            <span>Volatile (E) ‚¨õ</span>
          </div>

          <div class="isr-comparison">
            <div class="isr-comp-row">
              <span class="isr-comp-label">Actual ISR</span>
              <span class="isr-comp-value" id="isrCompActual" style="color:var(--green);">50.0%</span>
            </div>
            <div class="isr-comp-row">
              <span class="isr-comp-label">Target ISR (Age <span id="isrCompAge">50</span>)</span>
              <span class="isr-comp-value" id="isrCompTarget" style="color:var(--gold);">50.0%</span>
            </div>
            <div class="isr-comp-row">
              <span class="isr-comp-label">Deviation</span>
              <span class="isr-comp-value" id="isrCompDev">0.0%</span>
            </div>
          </div>

          <div class="isr-action balanced" id="isrActionBox">
            <strong>‚úÖ Balanced Portfolio</strong><br>
            Your ISR is well-aligned with your age-based target. G+R+D assets provide adequate INVESTMENT SAFETY RATIO while your equity allocation supports long-term growth. Maintain this allocation with periodic rebalancing.
          </div>
        </div>
      </div>
    </div>

    <!-- ISR Components -->
    <div class="card" style="margin-top:20px;">
      <div class="card-title">ISR Component Breakdown</div>
      <div id="isrComponentBars" class="bar-chart"></div>
    </div>
  </div>

</main>

<!-- FOOTER -->
<footer class="footer">
  <div class="footer-inner">
    <div class="footer-brand">
      <div class="footer-dots">
        <div class="footer-dot" style="background:var(--gold)"></div>
        <div class="footer-dot" style="background:var(--red)"></div>
        <div class="footer-dot" style="background:var(--blue)"></div>
        <div class="footer-dot" style="background:var(--green)"></div>
      </div>
      <span style="font-family:'Playfair Display',serif;font-size:14px;color:var(--text-secondary);">GRDE Engine</span>
    </div>
    <div class="footer-text">
      Created by <strong>Shakhith A.M</strong> with the help of AI<br>
      An Architect's Blueprint for Wealth ‚Äî The GRDE Framework
    </div>
    <div class="footer-disclaimer" id="footerDisclaimer">
      <strong>‚ö†Ô∏è Disclaimer:</strong> This is an educational tool for portfolio allocation awareness. It does not constitute personalised investment advice. No specific financial recommendations are made. Please consult a qualified and registered financial adviser in your jurisdiction before making investment decisions. Past performance does not guarantee future results.
    </div>
  </div>
</footer>

<script>
// ===================================================================
//  GRDE PORTFOLIO ENGINE ‚Äî Core Logic
// ===================================================================

// Age-based allocation model
// Linear interpolation between anchor points
const ANCHORS = [
  // age, G,  R,  D,  E
  [25,   5,  8, 12, 75],
  [30,   6, 10, 14, 70],
  [35,   7, 12, 17, 64],
  [40,   9, 15, 21, 55],
  [45,  10, 15, 23, 52],
  [50,  10, 15, 25, 50],
  [55,  12, 16, 27, 45],
  [60,  14, 17, 30, 39],
  [65,  15, 18, 34, 33],
  [70,  16, 18, 38, 28],
  [75,  18, 18, 40, 24],
  [80,  20, 18, 42, 20],
];

function getAllocation(age) {
  age = Math.max(25, Math.min(80, age));
  // Find bounding anchors
  let lo = ANCHORS[0], hi = ANCHORS[ANCHORS.length - 1];
  for (let i = 0; i < ANCHORS.length - 1; i++) {
    if (age >= ANCHORS[i][0] && age <= ANCHORS[i + 1][0]) {
      lo = ANCHORS[i]; hi = ANCHORS[i + 1]; break;
    }
  }
  if (lo[0] === hi[0]) return { G: lo[1], R: lo[2], D: lo[3], E: lo[4] };
  const t = (age - lo[0]) / (hi[0] - lo[0]);
  const lerp = (a, b) => Math.round((a + (b - a) * t) * 10) / 10;
  let g = lerp(lo[1], hi[1]), r = lerp(lo[2], hi[2]), d = lerp(lo[3], hi[3]);
  let e = 100 - g - r - d;
  e = Math.round(e * 10) / 10;
  return { G: g, R: r, D: d, E: e };
}

// ===================================================================
//  STATE
// ===================================================================
let currentAge = 50;
let currentAlloc = getAllocation(50);

// ===================================================================
//  TABS
// ===================================================================
document.querySelectorAll('.tab').forEach(tab => {
  tab.addEventListener('click', () => {
    document.querySelectorAll('.tab').forEach(t => t.classList.remove('active'));
    document.querySelectorAll('.tab-content').forEach(tc => tc.classList.remove('active'));
    tab.classList.add('active');
    document.getElementById('tab-' + tab.dataset.tab).classList.add('active');
    // Refresh data on tab switch
    updateAll();
  });
});

// ===================================================================
//  AGE SLIDER
// ===================================================================
const ageSlider = document.getElementById('ageSlider');
const ageDisplay = document.getElementById('ageDisplay');

ageSlider.addEventListener('input', () => {
  currentAge = parseInt(ageSlider.value);
  ageDisplay.textContent = currentAge;
  currentAlloc = getAllocation(currentAge);
  updateAll();
});

// ===================================================================
//  UPDATE FUNCTIONS
// ===================================================================
function updateAll() {
  updateAllocCards();
  updateDonut();
  updateBarChart();
  updateTracker();
  updateISR();
}

function updateAllocCards() {
  const items = [
    { id: 'G', key: 'G' }, { id: 'R', key: 'R' },
    { id: 'D', key: 'D' }, { id: 'E', key: 'E' }
  ];
  items.forEach(({ id, key }) => {
    const v = currentAlloc[key];
    document.getElementById('alloc' + id).textContent = v + '%';
    document.getElementById('bar' + id).style.width = v + '%';
  });
}

function updateDonut() {
  const circumference = 2 * Math.PI * 75; // ~471.24
  const order = ['E', 'D', 'R', 'G'];
  const ids = ['donutE', 'donutD', 'donutR', 'donutG'];
  let offset = 0;
  order.forEach((key, i) => {
    const pct = currentAlloc[key] / 100;
    const seg = circumference * pct;
    const el = document.getElementById(ids[i]);
    el.setAttribute('stroke-dasharray', `${seg} ${circumference - seg}`);
    el.setAttribute('stroke-dashoffset', `${-offset}`);
    offset += seg;
  });

  // Legend
  const colors = { G: 'var(--gold)', R: 'var(--red)', D: 'var(--blue)', E: 'var(--green)' };
  const names = { G: 'Gold & Silver', R: 'Real Estate', D: 'Debt', E: 'Equity' };
  const legend = document.getElementById('pieLegend');
  legend.innerHTML = ['G', 'R', 'D', 'E'].map(k => `
    <div class="legend-item">
      <div class="legend-dot" style="background:${colors[k]}"></div>
      <span class="legend-label">${names[k]}</span>
      <span class="legend-value">${currentAlloc[k]}%</span>
    </div>
  `).join('');
  
  // Update donut center with portfolio total
  const groups = getPortfolioTotals();
  const total = groups.G + groups.R + groups.D + groups.E;
  document.getElementById('donutTotal').textContent = total > 0 ? formatCurrency(total) : formatCurrency(getRegion().sampleTotal);
}

function updateBarChart() {
  const items = [
    { label: 'Gold', key: 'G', color: 'var(--gold)' },
    { label: 'Real Estate', key: 'R', color: 'var(--red)' },
    { label: 'Debt', key: 'D', color: 'var(--blue)' },
    { label: 'Equity', key: 'E', color: 'var(--green)' },
  ];
  const chart = document.getElementById('barChart');
  chart.innerHTML = items.map(({ label, key, color }) => `
    <div class="bar-row">
      <div class="bar-label">${label}</div>
      <div class="bar-track">
        <div class="bar-fill" style="width:${currentAlloc[key]}%;background:${color};">${currentAlloc[key]}%</div>
      </div>
    </div>
  `).join('');
}

// ===================================================================
//  REGION / CURRENCY SYSTEM
// ===================================================================
const REGIONS = {
  IN: {
    symbol: '‚Çπ', code: 'INR', locale: 'en-IN', flag: 'üáÆüá≥',
    sampleTotal: 1000000,
    formatLarge: (n) => {
      if (n >= 10000000) return '‚Çπ' + (n / 10000000).toFixed(2) + ' Cr';
      if (n >= 100000) return '‚Çπ' + (n / 100000).toFixed(2) + ' L';
      return '‚Çπ' + n.toLocaleString('en-IN');
    },
    labels: {
      goldEtf: 'Gold ETFs', silverEtf: 'Silver ETFs',
      reits: 'REITs', invits: 'InvITs',
      liquid: 'Liquid Funds', fd: 'FD + POMIS', bonds: 'Bonds / NCDs',
      mf: 'Mutual Funds', localEtf: 'Indian ETFs', intlEtf: 'US / Intl ETFs'
    },
    defaults: { goldEtf:90000, silverEtf:10000, reits:90000, invits:60000, liquid:100000, fd:150000, bonds:0, mf:250000, localEtf:200000, intlEtf:50000 }
  },
  US: {
    symbol: '$', code: 'USD', locale: 'en-US', flag: 'üá∫üá∏',
    sampleTotal: 100000,
    formatLarge: (n) => {
      if (n >= 1000000) return '$' + (n / 1000000).toFixed(2) + 'M';
      if (n >= 1000) return '$' + (n / 1000).toFixed(1) + 'K';
      return '$' + n.toLocaleString('en-US');
    },
    labels: {
      goldEtf: 'Gold ETFs (GLD/IAU)', silverEtf: 'Silver ETFs (SLV)',
      reits: 'REITs (VNQ/SCHH)', invits: 'Real Estate Funds',
      liquid: 'Money Market Funds', fd: 'CDs / T-Bills', bonds: 'Bond Funds (BND)',
      mf: 'Index Funds', localEtf: 'US Equity ETFs', intlEtf: 'International ETFs'
    },
    defaults: { goldEtf:8000, silverEtf:2000, reits:10000, invits:5000, liquid:12000, fd:13000, bonds:0, mf:25000, localEtf:20000, intlEtf:5000 }
  },
  GB: {
    symbol: '¬£', code: 'GBP', locale: 'en-GB', flag: 'üá¨üáß',
    sampleTotal: 80000,
    formatLarge: (n) => {
      if (n >= 1000000) return '¬£' + (n / 1000000).toFixed(2) + 'M';
      if (n >= 1000) return '¬£' + (n / 1000).toFixed(1) + 'K';
      return '¬£' + n.toLocaleString('en-GB');
    },
    labels: {
      goldEtf: 'Gold ETFs (SGLN)', silverEtf: 'Silver ETFs (SSLN)',
      reits: 'REITs (IUKP)', invits: 'Property Funds',
      liquid: 'Money Market Funds', fd: 'Savings Bonds / ISA', bonds: 'Gilt Funds',
      mf: 'OEIC / Unit Trusts', localEtf: 'UK Equity ETFs', intlEtf: 'Global ETFs'
    },
    defaults: { goldEtf:7000, silverEtf:1000, reits:8000, invits:4000, liquid:10000, fd:10000, bonds:0, mf:20000, localEtf:16000, intlEtf:4000 }
  },
  EU: {
    symbol: '‚Ç¨', code: 'EUR', locale: 'de-DE', flag: 'üá™üá∫',
    sampleTotal: 90000,
    formatLarge: (n) => {
      if (n >= 1000000) return '‚Ç¨' + (n / 1000000).toFixed(2) + 'M';
      if (n >= 1000) return '‚Ç¨' + (n / 1000).toFixed(1) + 'K';
      return '‚Ç¨' + n.toLocaleString('de-DE');
    },
    labels: {
      goldEtf: 'Gold ETFs (EGLN)', silverEtf: 'Silver ETFs',
      reits: 'REITs / Property ETFs', invits: 'Real Estate Funds',
      liquid: 'Money Market Funds', fd: 'Term Deposits', bonds: 'Bond Funds / Bunds',
      mf: 'UCITS Funds', localEtf: 'Euro Equity ETFs', intlEtf: 'Global ETFs'
    },
    defaults: { goldEtf:8000, silverEtf:1000, reits:9000, invits:4500, liquid:11000, fd:11500, bonds:0, mf:22000, localEtf:18000, intlEtf:5000 }
  },
  AE: {
    symbol: 'AED', code: 'AED', locale: 'en-AE', flag: 'üá¶üá™',
    sampleTotal: 400000,
    formatLarge: (n) => {
      if (n >= 1000000) return 'AED ' + (n / 1000000).toFixed(2) + 'M';
      if (n >= 1000) return 'AED ' + (n / 1000).toFixed(1) + 'K';
      return 'AED ' + n.toLocaleString('en-US');
    },
    labels: {
      goldEtf: 'Gold ETFs', silverEtf: 'Silver / Precious Metals',
      reits: 'REITs', invits: 'Real Estate Funds',
      liquid: 'Money Market Funds', fd: 'Fixed Deposits', bonds: 'Sukuk / Bonds',
      mf: 'Mutual Funds', localEtf: 'UAE / GCC ETFs', intlEtf: 'International ETFs'
    },
    defaults: { goldEtf:35000, silverEtf:5000, reits:35000, invits:25000, liquid:40000, fd:55000, bonds:0, mf:100000, localEtf:80000, intlEtf:25000 }
  },
  SG: {
    symbol: 'S$', code: 'SGD', locale: 'en-SG', flag: 'üá∏üá¨',
    sampleTotal: 130000,
    formatLarge: (n) => {
      if (n >= 1000000) return 'S$' + (n / 1000000).toFixed(2) + 'M';
      if (n >= 1000) return 'S$' + (n / 1000).toFixed(1) + 'K';
      return 'S$' + n.toLocaleString('en-SG');
    },
    labels: {
      goldEtf: 'Gold ETFs (GLD)', silverEtf: 'Silver ETFs',
      reits: 'S-REITs', invits: 'Real Estate Funds',
      liquid: 'Money Market Funds', fd: 'Fixed Deposits / SSB', bonds: 'Bond Funds (ABF)',
      mf: 'Unit Trusts', localEtf: 'STI ETFs', intlEtf: 'Global ETFs'
    },
    defaults: { goldEtf:11000, silverEtf:2000, reits:12000, invits:7000, liquid:13000, fd:18000, bonds:0, mf:33000, localEtf:27000, intlEtf:7000 }
  },
  AU: {
    symbol: 'A$', code: 'AUD', locale: 'en-AU', flag: 'üá¶üá∫',
    sampleTotal: 150000,
    formatLarge: (n) => {
      if (n >= 1000000) return 'A$' + (n / 1000000).toFixed(2) + 'M';
      if (n >= 1000) return 'A$' + (n / 1000).toFixed(1) + 'K';
      return 'A$' + n.toLocaleString('en-AU');
    },
    labels: {
      goldEtf: 'Gold ETFs (GOLD)', silverEtf: 'Silver / Precious Metals',
      reits: 'A-REITs (VAP)', invits: 'Property Funds',
      liquid: 'Cash / Money Market', fd: 'Term Deposits', bonds: 'Bond ETFs (VGB)',
      mf: 'Managed Funds', localEtf: 'ASX ETFs (VAS)', intlEtf: 'International ETFs'
    },
    defaults: { goldEtf:13000, silverEtf:2000, reits:14000, invits:7500, liquid:15000, fd:20000, bonds:0, mf:38000, localEtf:32000, intlEtf:8500 }
  },
  JP: {
    symbol: '¬•', code: 'JPY', locale: 'ja-JP', flag: 'üáØüáµ',
    sampleTotal: 15000000,
    formatLarge: (n) => {
      if (n >= 100000000) return '¬•' + (n / 100000000).toFixed(2) + 'ÂÑÑ';
      if (n >= 10000) return '¬•' + (n / 10000).toFixed(0) + '‰∏á';
      return '¬•' + n.toLocaleString('ja-JP');
    },
    labels: {
      goldEtf: 'Gold ETFs (1326)', silverEtf: 'Silver / Precious Metals',
      reits: 'J-REITs (1343)', invits: 'Real Estate Funds',
      liquid: 'MRF / Money Reserve', fd: 'Term Deposits / JGB', bonds: 'Bond Funds',
      mf: 'Toushin (Êäï‰ø°)', localEtf: 'TOPIX / Nikkei ETFs', intlEtf: 'Global ETFs'
    },
    defaults: { goldEtf:1300000, silverEtf:200000, reits:1400000, invits:700000, liquid:1500000, fd:2000000, bonds:0, mf:3800000, localEtf:3200000, intlEtf:900000 }
  },
  CA: {
    symbol: 'C$', code: 'CAD', locale: 'en-CA', flag: 'üá®üá¶',
    sampleTotal: 140000,
    formatLarge: (n) => {
      if (n >= 1000000) return 'C$' + (n / 1000000).toFixed(2) + 'M';
      if (n >= 1000) return 'C$' + (n / 1000).toFixed(1) + 'K';
      return 'C$' + n.toLocaleString('en-CA');
    },
    labels: {
      goldEtf: 'Gold ETFs (CGL)', silverEtf: 'Silver ETFs (SVR)',
      reits: 'REITs (XRE/VRE)', invits: 'Real Estate Funds',
      liquid: 'HISA / Money Market', fd: 'GICs', bonds: 'Bond ETFs (XBB)',
      mf: 'Mutual Funds', localEtf: 'TSX ETFs (XIU)', intlEtf: 'International ETFs'
    },
    defaults: { goldEtf:12000, silverEtf:2000, reits:13000, invits:7000, liquid:14000, fd:19000, bonds:0, mf:36000, localEtf:30000, intlEtf:7000 }
  },
  MY: {
    symbol: 'RM', code: 'MYR', locale: 'ms-MY', flag: 'üá≤üáæ',
    sampleTotal: 450000,
    formatLarge: (n) => {
      if (n >= 1000000) return 'RM' + (n / 1000000).toFixed(2) + 'M';
      if (n >= 1000) return 'RM' + (n / 1000).toFixed(1) + 'K';
      return 'RM' + n.toLocaleString('en-MY');
    },
    labels: {
      goldEtf: 'Gold ETFs / TH Gold', silverEtf: 'Silver / Precious Metals',
      reits: 'M-REITs', invits: 'Property Trust Funds',
      liquid: 'Money Market Funds', fd: 'Fixed Deposits', bonds: 'Sukuk / Bond Funds',
      mf: 'Unit Trust Funds', localEtf: 'KLCI ETFs', intlEtf: 'Global ETFs'
    },
    defaults: { goldEtf:40000, silverEtf:5000, reits:40000, invits:25000, liquid:45000, fd:60000, bonds:0, mf:115000, localEtf:95000, intlEtf:25000 }
  }
};

let currentRegion = 'IN';

function getRegion() { return REGIONS[currentRegion]; }

function formatCurrency(n) { return getRegion().formatLarge(n); }

function applyRegion(regionCode) {
  currentRegion = regionCode;
  const r = getRegion();
  
  // Update input labels
  const labelMap = {
    'inp-goldEtf': r.labels.goldEtf, 'inp-silverEtf': r.labels.silverEtf,
    'inp-reits': r.labels.reits, 'inp-invits': r.labels.invits,
    'inp-liquid': r.labels.liquid, 'inp-fd': r.labels.fd, 'inp-bonds': r.labels.bonds,
    'inp-mf': r.labels.mf, 'inp-inEtf': r.labels.localEtf, 'inp-usEtf': r.labels.intlEtf
  };
  Object.entries(labelMap).forEach(([id, label]) => {
    const inp = document.getElementById(id);
    if (inp) {
      const labelEl = inp.closest('.input-group').querySelector('.input-label');
      const dot = labelEl.querySelector('.input-dot');
      const dotHTML = dot ? dot.outerHTML : '';
      labelEl.innerHTML = dotHTML + ' ' + label;
    }
  });
  
  // Update placeholders
  document.querySelectorAll('.portfolio-input').forEach(inp => {
    inp.placeholder = r.symbol + ' 0';
  });
  
  // Update default values
  const defaultMap = {
    'inp-goldEtf': r.defaults.goldEtf, 'inp-silverEtf': r.defaults.silverEtf,
    'inp-reits': r.defaults.reits, 'inp-invits': r.defaults.invits,
    'inp-liquid': r.defaults.liquid, 'inp-fd': r.defaults.fd, 'inp-bonds': r.defaults.bonds,
    'inp-mf': r.defaults.mf, 'inp-inEtf': r.defaults.localEtf, 'inp-usEtf': r.defaults.intlEtf
  };
  Object.entries(defaultMap).forEach(([id, val]) => {
    const inp = document.getElementById(id);
    if (inp) inp.value = val > 0 ? val : '';
  });
  
  // Update variance table header
  document.getElementById('thActualAmt').textContent = 'Actual ' + r.symbol;
  
  // Update donut center
  const total = r.sampleTotal;
  document.getElementById('donutTotal').textContent = r.formatLarge(total);
  
  // Refresh everything
  updateAll();
}

// Region selector handler
document.getElementById('regionSelect').addEventListener('change', (e) => {
  applyRegion(e.target.value);
});

// ===================================================================
//  PORTFOLIO TRACKER
// ===================================================================
function parseVal(el) {
  return parseFloat(el.value.replace(/[^0-9.]/g, '')) || 0;
}

function getPortfolioTotals() {
  const groups = { G: 0, R: 0, D: 0, E: 0 };
  document.querySelectorAll('.portfolio-input').forEach(inp => {
    groups[inp.dataset.group] += parseVal(inp);
  });
  return groups;
}

function updateTracker() {
  const groups = getPortfolioTotals();
  const total = groups.G + groups.R + groups.D + groups.E;

  document.getElementById('totalG').textContent = formatCurrency(groups.G);
  document.getElementById('totalR').textContent = formatCurrency(groups.R);
  document.getElementById('totalD').textContent = formatCurrency(groups.D);
  document.getElementById('totalE').textContent = formatCurrency(groups.E);
  document.getElementById('portfolioTotal').textContent = formatCurrency(total);

  // Variance table
  const body = document.getElementById('varianceBody');
  const items = [
    { name: 'Gold & Silver', key: 'G', color: 'var(--gold)' },
    { name: 'Real Estate', key: 'R', color: 'var(--red)' },
    { name: 'Debt', key: 'D', color: 'var(--blue)' },
    { name: 'Equity', key: 'E', color: 'var(--green)' },
  ];
  body.innerHTML = items.map(({ name, key, color }) => {
    const actual = total > 0 ? (groups[key] / total * 100) : 0;
    const target = currentAlloc[key];
    const variance = actual - target;
    const cls = Math.abs(variance) < 1 ? 'variance-neutral' : (variance > 0 ? 'variance-positive' : 'variance-negative');
    const sign = variance > 0 ? '+' : '';
    return `<tr>
      <td style="color:${color};font-weight:600;">${name}</td>
      <td>${formatCurrency(groups[key])}</td>
      <td>${actual.toFixed(1)}%</td>
      <td>${target}%</td>
      <td class="${cls}">${sign}${variance.toFixed(1)}%</td>
    </tr>`;
  }).join('');
}

// Format inputs on change
document.querySelectorAll('.portfolio-input').forEach(inp => {
  inp.addEventListener('input', () => updateAll());
  inp.addEventListener('focus', function() {
    this.value = this.value.replace(/[^0-9]/g, '');
  });
  inp.addEventListener('blur', function() {
    const v = parseFloat(this.value.replace(/[^0-9.]/g, '')) || 0;
    this.value = v > 0 ? v : '';
  });
});

// ===================================================================
//  ISR ‚Äî FULLY INTERACTIVE
// ===================================================================
function updateISR() {
  const groups = getPortfolioTotals();
  const total = groups.G + groups.R + groups.D + groups.E;
  
  // Actual ISR from portfolio
  const stableAmt = groups.G + groups.R + groups.D;
  const actualISR = total > 0 ? (stableAmt / total * 100) : 0;
  
  // Target ISR from age
  const targetISR = currentAlloc.G + currentAlloc.R + currentAlloc.D;
  const deviation = actualISR - targetISR;

  // Update gauge arc
  const circumference = 2 * Math.PI * 80; // ~502.65
  const arcLength = (actualISR / 100) * circumference;
  const isrArc = document.getElementById('isrArc');
  isrArc.setAttribute('stroke-dasharray', `${arcLength} ${circumference - arcLength}`);

  // Color the arc based on status
  const status = getISRStatus(actualISR);
  const statusColors = {
    aggressive: '#E74C3C', moderate: 'var(--gold)',
    balanced: '#2ECC71', conservative: '#3498DB'
  };
  isrArc.setAttribute('stroke', statusColors[status]);

  // Score
  document.getElementById('isrActualScore').textContent = actualISR.toFixed(1) + '%';
  document.getElementById('isrActualScore').style.color = statusColors[status];

  // Badge
  const badge = document.getElementById('isrBadge');
  badge.className = 'isr-status-badge ' + status;
  const statusLabels = {
    aggressive: '‚ö† Aggressive ‚Äî High Risk',
    moderate: '‚óê Moderate Risk',
    balanced: '‚úì Balanced Portfolio',
    conservative: '‚óà Conservative ‚Äî Very Stable'
  };
  document.getElementById('isrBadgeText').textContent = statusLabels[status];

  // Split bar
  document.getElementById('isrBarStable').style.width = actualISR + '%';
  document.getElementById('isrBarGrowth').style.width = (100 - actualISR) + '%';
  document.getElementById('isrBarStableText').textContent = actualISR.toFixed(0) + '%';
  document.getElementById('isrBarGrowthText').textContent = (100 - actualISR).toFixed(0) + '%';

  // Comparison table
  document.getElementById('isrCompActual').textContent = actualISR.toFixed(1) + '%';
  document.getElementById('isrCompActual').style.color = statusColors[status];
  document.getElementById('isrCompTarget').textContent = targetISR.toFixed(1) + '%';
  document.getElementById('isrCompAge').textContent = currentAge;
  
  const devEl = document.getElementById('isrCompDev');
  const devSign = deviation > 0 ? '+' : '';
  devEl.textContent = devSign + deviation.toFixed(1) + '%';
  devEl.style.color = Math.abs(deviation) < 3 ? '#2ECC71' : (deviation > 0 ? '#3498DB' : '#E74C3C');

  // Action plan
  const actionBox = document.getElementById('isrActionBox');
  actionBox.className = 'isr-action ' + status;
  actionBox.innerHTML = getActionPlan(status, actualISR, targetISR, deviation);

  // Component bars
  const compChart = document.getElementById('isrComponentBars');
  const compData = [
    { label: 'Gold (G)', pct: total > 0 ? (groups.G / total * 100) : 0, color: 'var(--gold)', type: 'stable' },
    { label: 'Real Estate (R)', pct: total > 0 ? (groups.R / total * 100) : 0, color: 'var(--red)', type: 'stable' },
    { label: 'Debt (D)', pct: total > 0 ? (groups.D / total * 100) : 0, color: 'var(--blue)', type: 'stable' },
    { label: 'Equity (E)', pct: total > 0 ? (groups.E / total * 100) : 0, color: 'var(--green)', type: 'growth' },
  ];
  compChart.innerHTML = compData.map(({ label, pct, color, type }) => `
    <div class="bar-row">
      <div class="bar-label">${label}</div>
      <div class="bar-track">
        <div class="bar-fill" style="width:${pct}%;background:${color};">${pct.toFixed(1)}%</div>
      </div>
    </div>
  `).join('') + `
    <div style="display:flex;gap:16px;margin-top:8px;font-size:12px;color:var(--text-muted);">
      <span>‚óº Stable Components: <strong style="color:var(--text-secondary)">${actualISR.toFixed(1)}%</strong></span>
      <span>‚óº Growth Components: <strong style="color:var(--text-secondary)">${(100 - actualISR).toFixed(1)}%</strong></span>
    </div>
  `;
}

function getISRStatus(isr) {
  if (isr < 40) return 'aggressive';
  if (isr < 50) return 'moderate';
  if (isr <= 60) return 'balanced';
  return 'conservative';
}

function getActionPlan(status, actual, target, dev) {
  const plans = {
    aggressive: `
      <strong>‚ö†Ô∏è Aggressive Allocation ‚Äî Action Required</strong><br><br>
      Your ISR of <strong>${actual.toFixed(1)}%</strong> is below the 40% threshold, meaning over 60% of your portfolio is in volatile equity. 
      While this maximises growth potential, it exposes you to significant short-term drawdowns.<br><br>
      <strong>Suggested Actions:</strong> Increase allocation to Debt instruments (liquid funds, bonds) and consider adding Gold or REITs to bring your ISR closer to the ${target.toFixed(0)}% target for age ${currentAge}.
    `,
    moderate: `
      <strong>‚óê Moderate Risk ‚Äî Fine-Tuning Recommended</strong><br><br>
      Your ISR of <strong>${actual.toFixed(1)}%</strong> is approaching the balanced zone but still below 50%. 
      Your equity tilt supports growth, but a small shift toward stable assets would improve resilience.<br><br>
      <strong>Suggested Actions:</strong> A modest rebalance ‚Äî shift ${Math.abs(dev).toFixed(0)}-${(Math.abs(dev)+5).toFixed(0)}% from equity toward debt or gold ‚Äî would align you with the ${target.toFixed(0)}% target for age ${currentAge}.
    `,
    balanced: `
      <strong>‚úÖ Balanced Portfolio ‚Äî Well Aligned</strong><br><br>
      Your ISR of <strong>${actual.toFixed(1)}%</strong> sits in the ideal 50-60% range. Your stable assets (G+R+D) provide reliable income and downside protection, while equity drives long-term growth.<br><br>
      <strong>Recommendation:</strong> Maintain this allocation with periodic rebalancing. You're ${Math.abs(dev) < 3 ? 'right on target' : dev > 0 ? 'slightly conservative ‚Äî consider if you want more growth exposure' : 'slightly growth-tilted ‚Äî consider if you need more stability'} for age ${currentAge}.
    `,
    conservative: `
      <strong>‚óà Conservative Allocation ‚Äî Stability Prioritised</strong><br><br>
      Your ISR of <strong>${actual.toFixed(1)}%</strong> exceeds 60%, heavily favouring income stability. 
      While this minimises volatility, it may limit long-term capital appreciation, especially if you have a longer investment horizon.<br><br>
      <strong>Suggested Actions:</strong> If your timeline permits, gradually increasing equity by ${Math.abs(dev).toFixed(0)}-${(Math.abs(dev)+5).toFixed(0)}% could improve returns while maintaining adequate safety for age ${currentAge}.
    `
  };
  return plans[status];
}

// ===================================================================
//  INIT
// ===================================================================
updateAll();

// ===================================================================
//  PWA: Service Worker Registration
// ===================================================================
if ('serviceWorker' in navigator) {
  window.addEventListener('load', () => {
    navigator.serviceWorker.register('service-worker.js')
      .then(reg => console.log('SW registered:', reg.scope))
      .catch(err => console.log('SW registration failed:', err));
  });
}

// ===================================================================
//  PWA: Install Prompt
// ===================================================================
let deferredPrompt;
window.addEventListener('beforeinstallprompt', (e) => {
  e.preventDefault();
  deferredPrompt = e;
  showInstallBanner();
});

function showInstallBanner() {
  if (document.getElementById('installBanner')) return;
  const banner = document.createElement('div');
  banner.id = 'installBanner';
  banner.style.cssText = `
    position:fixed;bottom:0;left:0;right:0;z-index:9999;
    background:var(--bg-card);border-top:1px solid var(--border);
    padding:16px 24px;display:flex;align-items:center;gap:14px;
    backdrop-filter:blur(20px);animation:slideUp 0.4s ease;
  `;
  banner.innerHTML = `
    <div style="display:grid;grid-template-columns:1fr 1fr;gap:3px;width:28px;height:28px;flex-shrink:0;">
      <div style="width:12px;height:12px;border-radius:50%;background:var(--gold)"></div>
      <div style="width:12px;height:12px;border-radius:50%;background:var(--red)"></div>
      <div style="width:12px;height:12px;border-radius:50%;background:var(--blue)"></div>
      <div style="width:12px;height:12px;border-radius:50%;background:var(--green)"></div>
    </div>
    <div style="flex:1;">
      <div style="font-size:14px;font-weight:600;color:var(--text-primary);">Install GRDE Engine</div>
      <div style="font-size:12px;color:var(--text-secondary);">Add to home screen for quick access</div>
    </div>
    <button id="installBtn" style="
      padding:8px 20px;border-radius:8px;border:none;cursor:pointer;
      background:var(--gold);color:#000;font-weight:600;font-size:13px;
      font-family:inherit;
    ">Install</button>
    <button id="dismissBtn" style="
      padding:8px 12px;border:none;cursor:pointer;background:transparent;
      color:var(--text-muted);font-size:18px;font-family:inherit;
    ">‚úï</button>
  `;
  document.body.appendChild(banner);
  
  document.getElementById('installBtn').addEventListener('click', async () => {
    if (deferredPrompt) {
      deferredPrompt.prompt();
      const { outcome } = await deferredPrompt.userChoice;
      deferredPrompt = null;
      banner.remove();
    }
  });
  document.getElementById('dismissBtn').addEventListener('click', () => banner.remove());
}

// Add slideUp animation
const styleSheet = document.createElement('style');
styleSheet.textContent = `@keyframes slideUp { from { transform: translateY(100%); } to { transform: translateY(0); } }`;
document.head.appendChild(styleSheet);
</script>
</body>
</html>
